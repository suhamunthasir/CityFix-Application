<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Announcements - CityFix Sri Lanka</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f5f5f5; color: #333; margin: 0; padding: 0;}
    .container { width: 90%; max-width: 1200px; margin: 2rem auto;}
    h1 { text-align: center; color: #333; margin-bottom: 1.5rem;}
    
    /* Filters */
    .filters { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin-bottom: 2rem; }
    .filters select { padding: 0.5rem; border-radius: 5px; border: 1px solid #ccc; }

    /* Announcements Grid */
    .announcements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem;}
    .announcement-card { background: white; border-radius: 10px; padding: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column;}
    .announcement-card img { width: 100%; max-height: 200px; object-fit: cover; border-radius: 6px; margin-bottom: 0.5rem;}
    .announcement-card h3 { margin: 0.5rem 0; font-size: 1.3rem; color: #e67e22;}
    .announcement-card p { margin: 0.3rem 0; color: #555; font-size: 0.95rem;}
    .info { font-size: 0.8rem; color: #888; margin-top: auto;}
    
    .empty-state { text-align: center; color: #666; margin-top: 3rem; display: none;}
    .empty-state.show { display: block; }

    /* Header */
    header {
        background-color: #333;
        color: white;
        padding: 1rem 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .header-container { width: 90%; max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
    .logo { font-size: 1.8rem; font-weight: bold; color: #e67e22;}
    .logo span { color: #e74c3c;}
    nav ul { display: flex; list-style: none; margin: 0; padding: 0;}
    nav ul li { margin-left: 1.5rem;}
    nav ul li a { color: white; padding: 0.5rem 0.8rem; border-radius: 4px; transition: background-color 0.3s; text-decoration: none;}
    nav ul li a:hover, nav ul li a.active { background-color: #555; color: white; font-weight: bold;}

    @media (max-width: 768px) {
        .header-container { flex-direction: column;}
        nav ul { margin-top: 0.8rem; flex-direction: column; gap: 0.5rem;}
        nav ul li { margin-left: 0;}
    }
    .filters {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 2rem;
}

.filters select {
    min-width: 220px;          /* Longer by default */
    max-width: 300px;          /* Avoid being too long on large screens */
    width: 100%;               /* Fill available space in flex item */
    padding: 0.6rem 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    background-color: #fff;
    font-size: 0.95rem;
    color: #333;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: all 0.3s ease;
    appearance: none; 
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0L5 6L10 0H0Z' fill='%23666'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center; /* more spacing for wider dropdown */
    background-size: 10px 6px;
}

.filters select:hover {
    border-color: #e67e22;
    box-shadow: 0 4px 10px rgba(230,126,34,0.2);
}

.filters select:focus {
    outline: none;
    border-color: #e74c3c;
    box-shadow: 0 0 0 3px rgba(231,76,60,0.2);
}

/* Mobile responsiveness */
@media (max-width: 500px) {
    .filters {
        flex-direction: column;
        align-items: center;
    }
    .filters select {
        width: 90%;
        min-width: 0;
    }
}
</style>
</head>
<body>

<!-- Header -->
<header>
    <div class="header-container">
        <div class="logo">City<span>Fix</span></div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="signin.html">Sign In</a></li>
                <li><a href="allReport.html">All Reports</a></li>
                <li><a href="#" class="active">Announcements</a></li>
                <li><a href="help.html">Help</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">
    <h1>Announcements</h1>

    <!-- Filters -->
    <div class="filters">
        <select id="priorityFilter">
            <option value="">All Priorities</option>
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
        </select>
        <select id="categoryFilter">
            <option value="">All Categories</option>
             <option value="Electricity">Electricity</option>
                  <option value="Water Supply">Water Supply</option>
                  <option value="Sanitation">Sanitation</option>
                   <option value="Environment">Environment</option>
            <!-- Add more categories as needed -->
        </select>
    </div>

    <div id="announcementsGrid" class="announcements-grid"></div>
    <div id="emptyState" class="empty-state">
        <p>No announcements found.</p>
    </div>
</div>

<script>
const API_BASE = "http://localhost:8080/api/announcements";
const IMAGE_BASE_URL = "http://localhost:8080/api/announcements/images/";

let allAnnouncements = [];

async function fetchAnnouncements() {
    try {
        const res = await fetch(API_BASE);
        const data = await res.json();

        // Sort latest first based on createdDate and createdTime
        data.sort((a, b) => {
            const dateA = new Date(a.createdDate + 'T' + (a.createdTime || '00:00'));
            const dateB = new Date(b.createdDate + 'T' + (b.createdTime || '00:00'));
            return dateB - dateA;
        });

        allAnnouncements = data;
        displayAnnouncements(data);
    } catch(err) {
        console.error(err);
        const empty = document.getElementById('emptyState');
        empty.classList.add('show');
        empty.textContent = 'Failed to load announcements.';
    }
}

function displayAnnouncements(announcements) {
    const grid = document.getElementById('announcementsGrid');
    const emptyState = document.getElementById('emptyState');
    grid.innerHTML = "";

    if (!announcements || announcements.length === 0) {
        emptyState.classList.add('show');
        return;
    }
    emptyState.classList.remove('show');

    announcements.forEach(ann => {
        const card = document.createElement('div');
        card.className = 'announcement-card';

        if (ann.images) {
            const imgs = Array.isArray(ann.images) ? ann.images : ann.images.split(",");
            imgs.forEach(img => {
                if(img.trim()) {
                    const imgEl = document.createElement('img');
                    imgEl.src = IMAGE_BASE_URL + img.trim();
                    card.appendChild(imgEl);
                }
            });
        }

        const titleEl = document.createElement('h3');
        titleEl.textContent = ann.title;
        card.appendChild(titleEl);

        const contentEl = document.createElement('p');
        contentEl.textContent = ann.content;
        card.appendChild(contentEl);

        const infoEl = document.createElement('p');
        infoEl.className = 'info';

        // Format time to 24-hour HH:mm
        let time = ann.createdTime ? ann.createdTime.slice(0,5) : '00:00';
        infoEl.innerHTML = `
            Priority: <b>${ann.priority || 'N/A'}</b> |
            Category: <b>${ann.category || 'N/A'}</b> |
            Created By: <b>${ann.createdBy || 'N/A'}</b><br>
            Date: <b>${ann.createdDate || 'N/A'}</b> |
            Time: <b>${time}</b>
        `;
        card.appendChild(infoEl);

        grid.appendChild(card);
    });
}

// Filter functionality
document.getElementById('priorityFilter').addEventListener('change', applyFilters);
document.getElementById('categoryFilter').addEventListener('change', applyFilters);

function applyFilters() {
    const priority = document.getElementById('priorityFilter').value;
    const category = document.getElementById('categoryFilter').value;

    let filtered = allAnnouncements;

    if (priority) filtered = filtered.filter(a => a.priority === priority);
    if (category) filtered = filtered.filter(a => a.category === category);

    displayAnnouncements(filtered);
}

fetchAnnouncements();
</script>

</body>
</html>
